<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sage Data Sources Reference</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        h1 { color: #172B4D; border-bottom: 2px solid #0052CC; padding-bottom: 10px; }
        h2 { color: #172B4D; margin-top: 30px; }
        h3 { color: #42526E; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #DFE1E6; padding: 10px 12px; text-align: left; }
        th { background-color: #F4F5F7; color: #172B4D; font-weight: 600; }
        tr:nth-child(even) { background-color: #FAFBFC; }
        code { background-color: #F4F5F7; padding: 2px 6px; border-radius: 3px; font-family: monospace; color: #172B4D; }
        .status-primary { background-color: #0052CC; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px; }
        .status-active { background-color: #00875A; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px; }
        .status-deprecated { background-color: #97A0AF; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px; }
        .info-box { background-color: #DEEBFF; border-left: 4px solid #0052CC; padding: 15px; margin: 15px 0; }
        .warning-box { background-color: #FFFAE6; border-left: 4px solid #FF8B00; padding: 15px; margin: 15px 0; }
        .diagram { background-color: #F4F5F7; padding: 20px; border-radius: 5px; font-family: monospace; white-space: pre; overflow-x: auto; }
    </style>
</head>
<body>

<h1>Sage Data Sources Reference</h1>

<p>This document provides an overview of all data sources used by Sage for file, domain, and IP classification.</p>

<h2>1. Data Sources Summary</h2>

<table>
    <tr>
        <th>#</th>
        <th>CPType</th>
        <th>Data Source</th>
        <th>Type</th>
        <th>Query Key</th>
        <th>MongoDB Collection</th>
        <th>Status</th>
    </tr>
    <tr>
        <td>1</td>
        <td><code>VIRUS_TOTAL</code></td>
        <td><strong>VirusTotal (VT Feeder)</strong></td>
        <td>GCS Bucket</td>
        <td>SHA1/MD5/SHA256</td>
        <td><code>file_rep</code>, <code>domain_classification</code></td>
        <td><span class="status-primary">Primary</span></td>
    </tr>
    <tr>
        <td>2</td>
        <td><code>REVERSING_LABS</code></td>
        <td><strong>Reversing Labs</strong></td>
        <td>External API</td>
        <td>SHA1</td>
        <td><code>reversing_labs_file</code></td>
        <td><span class="status-active">Active</span></td>
    </tr>
    <tr>
        <td>3</td>
        <td><code>OPSWAT</code></td>
        <td><strong>OPSWAT MetaDefender</strong></td>
        <td>External API</td>
        <td>SHA1/MD5</td>
        <td><code>opswat_file</code></td>
        <td><span class="status-active">Active</span></td>
    </tr>
    <tr>
        <td>4</td>
        <td><code>TOKEN</code></td>
        <td><strong>Internal Token Library</strong></td>
        <td>MongoDB</td>
        <td>SHA1/Domain/IP</td>
        <td><code>TOKENS</code></td>
        <td><span class="status-active">Active</span></td>
    </tr>
    <tr>
        <td>5</td>
        <td><code>DNS_RESOLVER</code></td>
        <td><strong>DNS Resolution Service</strong></td>
        <td>Internal</td>
        <td>Domain</td>
        <td><code>domain_dns</code></td>
        <td><span class="status-active">Active</span></td>
    </tr>
    <tr>
        <td>6</td>
        <td><code>STIX_TAXII</code></td>
        <td><strong>TAXII/STIX Threat Intel</strong></td>
        <td>External Feed</td>
        <td>SHA1/Domain</td>
        <td><code>threat_feed</code></td>
        <td><span class="status-active">Active</span></td>
    </tr>
    <tr>
        <td>7</td>
        <td><code>CUSTOMER_CLASSIFICATION</code></td>
        <td><strong>Customer Blocklist</strong></td>
        <td>MongoDB</td>
        <td>SHA1/Domain/IP</td>
        <td><code>customer_classification</code></td>
        <td><span class="status-active">Active (Private)</span></td>
    </tr>
    <tr>
        <td>8</td>
        <td><code>AV_REPORTED</code></td>
        <td><strong>Antivirus Reports</strong></td>
        <td>Sensor Upload</td>
        <td>SHA1</td>
        <td><code>av_classification</code></td>
        <td><span class="status-active">Active</span></td>
    </tr>
    <tr>
        <td>9</td>
        <td><code>ISIGHT</code></td>
        <td><strong>iSight Partners</strong></td>
        <td>External API</td>
        <td>SHA1/Domain/IP</td>
        <td>-</td>
        <td><span class="status-deprecated">Deprecated</span></td>
    </tr>
</table>

<h2>2. Data Sources by Classification Type</h2>

<div class="warning-box">
    <strong>Important:</strong> Different classification types use different data sources!
</div>

<table>
    <tr>
        <th>Data Source</th>
        <th>File</th>
        <th>Domain</th>
        <th>IP</th>
    </tr>
    <tr>
        <td><strong>VirusTotal (VT Feeder)</strong></td>
        <td>✅ Primary</td>
        <td>✅ Primary</td>
        <td>❌ Not used</td>
    </tr>
    <tr>
        <td><strong>Reversing Labs</strong></td>
        <td>✅</td>
        <td>❌</td>
        <td>❌</td>
    </tr>
    <tr>
        <td><strong>OPSWAT</strong></td>
        <td>✅</td>
        <td>❌</td>
        <td>❌</td>
    </tr>
    <tr>
        <td><strong>Token Library</strong></td>
        <td>✅</td>
        <td>✅</td>
        <td>✅ <strong>Only source!</strong></td>
    </tr>
    <tr>
        <td><strong>DNS Resolver</strong></td>
        <td>❌</td>
        <td>✅</td>
        <td>❌</td>
    </tr>
    <tr>
        <td><strong>Customer Blocklist</strong></td>
        <td>✅</td>
        <td>✅</td>
        <td>✅</td>
    </tr>
</table>

<div class="info-box">
    <strong>IP Classification Note:</strong> IP classification <u>only</u> uses the <strong>Token library</strong> (internal curated list). 
    There is NO VirusTotal or other external API for IP classification.
</div>

<h2>3. VT Feeder Architecture (Primary Data Source)</h2>

<div class="info-box">
    <strong>Key Change:</strong> Sage no longer calls VirusTotal API directly. Instead, it reads pre-fetched VT reports from Google Cloud Storage (GCS) buckets via VT Feeder.
</div>

<h3>Configuration</h3>
<table>
    <tr>
        <th>Property</th>
        <th>Value</th>
    </tr>
    <tr>
        <td><code>virus.total.vt.feeder.enabled</code></td>
        <td><code>true</code> (default)</td>
    </tr>
    <tr>
        <td><code>virus.total.vt.feeder.report.bucket.name</code></td>
        <td><code>vt-file-feeder</code></td>
    </tr>
    <tr>
        <td><code>virus.total.vt.feeder.classification.bucket.name</code></td>
        <td><code>broccoli-enricher</code></td>
    </tr>
    <tr>
        <td><code>virus.total.vt.feeder.folder.name</code></td>
        <td><code>latest-reports</code></td>
    </tr>
</table>

<h3>Architecture Diagram</h3>
<div class="diagram">
┌─────────────────┐
│   VirusTotal    │
│   (External)    │
└────────┬────────┘
         │ Periodic Push
         ▼
┌─────────────────────────────────────────────┐
│          Google Cloud Storage                │
│  ┌───────────────────┐  ┌─────────────────┐ │
│  │  vt-file-feeder   │  │ broccoli-enricher│ │
│  │  /latest-reports/ │  │ /latest-reports/ │ │
│  │  └── {hash}.json  │  │ └── {hash}.json  │ │
│  │  (Raw VT Report)  │  │ (Classification) │ │
│  └───────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────┘
         │ Read by Hash
         ▼
┌─────────────────┐      ┌─────────────────┐
│  VtFeederClient │ ───▶ │   Sage Server   │
└─────────────────┘      └─────────────────┘
</div>

<h2>4. External API Data Sources</h2>

<table>
    <tr>
        <th>Data Source</th>
        <th>Host</th>
        <th>API Endpoint</th>
        <th>Auth Method</th>
        <th>Query Key</th>
    </tr>
    <tr>
        <td><strong>Reversing Labs</strong></td>
        <td><code>ticloud-aws1-api.reversinglabs.com</code></td>
        <td><code>GET /api/databrowser/malware_presence/query/sha1/{hash}</code></td>
        <td>Basic Auth</td>
        <td>SHA1 only</td>
    </tr>
    <tr>
        <td><strong>OPSWAT</strong></td>
        <td><code>api.metadefender.com</code></td>
        <td><code>GET /v2/hash/{hash}</code></td>
        <td>Header: <code>apikey</code></td>
        <td>SHA1 or MD5</td>
    </tr>
</table>

<h2>5. Internal Data Sources</h2>

<table>
    <tr>
        <th>Data Source</th>
        <th>Description</th>
        <th>MongoDB Collection</th>
        <th>Query Key</th>
    </tr>
    <tr>
        <td><strong>Token Library</strong></td>
        <td>Cybereason's curated list of known malicious/benign hashes, domains, IPs</td>
        <td><code>TOKENS</code></td>
        <td>SHA1, Domain, IP</td>
    </tr>
    <tr>
        <td><strong>DNS Resolver</strong></td>
        <td>Resolves domains and detects sinkhole indicators</td>
        <td><code>domain_dns</code></td>
        <td>Domain</td>
    </tr>
    <tr>
        <td><strong>Customer Blocklist</strong></td>
        <td>Customer-defined blocklists (Sage Private only)</td>
        <td><code>customer_classification</code></td>
        <td>SHA1, Domain, IP</td>
    </tr>
</table>

<h2>6. Data Source Priority</h2>

<p>When multiple data sources return results, Sage uses priority-based decision:</p>

<ol>
    <li><strong>Token</strong> - Internal whitelist/blacklist (highest priority)</li>
    <li><strong>VirusTotal</strong> - VT Feeder classification</li>
    <li><strong>Reversing Labs</strong> - Additional file classification</li>
    <li><strong>OPSWAT</strong> - Additional file classification</li>
</ol>

<h2>7. Key Takeaway: All Queries Use Hash</h2>

<div class="warning-box">
    <strong>Important:</strong> All data sources use <strong>file hash</strong> (SHA1/MD5/SHA256) as the query key.<br>
    <code>submission_names</code> and other filename metadata are <strong>returned results</strong>, not query inputs.
</div>

<table>
    <tr>
        <th>Data Source</th>
        <th>Query Pattern</th>
        <th>Example</th>
    </tr>
    <tr>
        <td>VT Feeder</td>
        <td><code>gs://vt-file-feeder/latest-reports/{hash}</code></td>
        <td><code>latest-reports/a1b2c3d4e5...</code></td>
    </tr>
    <tr>
        <td>Reversing Labs</td>
        <td><code>/api/.../sha1/{hash}</code></td>
        <td><code>/sha1/a1b2c3d4e5...</code></td>
    </tr>
    <tr>
        <td>OPSWAT</td>
        <td><code>/v2/hash/{hash}</code></td>
        <td><code>/v2/hash/a1b2c3d4e5...</code></td>
    </tr>
    <tr>
        <td>Token</td>
        <td>MongoDB query by <code>_id</code></td>
        <td><code>findById("a1b2c3d4e5...")</code></td>
    </tr>
</table>

<h2>8. Phoenix Migration Recommendation</h2>

<h3>What to Store</h3>
<table>
    <tr>
        <th>Field</th>
        <th>Type</th>
        <th>Purpose</th>
        <th>Required</th>
    </tr>
    <tr>
        <td><code>sha1</code></td>
        <td>String (40 chars)</td>
        <td>Primary key / Query key</td>
        <td>✅ Yes</td>
    </tr>
    <tr>
        <td><code>md5</code></td>
        <td>String (32 chars)</td>
        <td>Alternate query key</td>
        <td>✅ Yes</td>
    </tr>
    <tr>
        <td><code>sha256</code></td>
        <td>String (64 chars)</td>
        <td>Alternate query key</td>
        <td>✅ Yes</td>
    </tr>
    <tr>
        <td><code>classification_type</code></td>
        <td>String</td>
        <td>malware, indifferent, unknown</td>
        <td>✅ Yes</td>
    </tr>
    <tr>
        <td><code>classification_subtype</code></td>
        <td>String</td>
        <td>trojan, ransomware, etc.</td>
        <td>✅ Yes</td>
    </tr>
    <tr>
        <td><code>submission_names</code></td>
        <td>List&lt;String&gt;</td>
        <td>Historical filenames (VT metadata)</td>
        <td>❌ No (large, not needed for query)</td>
    </tr>
</table>

<h3>Direct GCS Access Option</h3>
<p>Phoenix can bypass Sage and read directly from GCS buckets:</p>
<ul>
    <li><strong>Report Bucket:</strong> <code>gs://vt-file-feeder/latest-reports/{hash}</code></li>
    <li><strong>Classification Bucket:</strong> <code>gs://broccoli-enricher/latest-reports/{hash}</code></li>
</ul>

<h2>9. SubType Classification (Runtime Calculation)</h2>

<div class="info-box">
    <strong>Key Finding:</strong> SAGE calculates <code>subType</code> at runtime by applying wildcard pattern matching against VT detection names. SubTypes are <strong>NOT stored</strong> in MongoDB - they are computed on-the-fly and returned in API responses only.
</div>

<h3>How SubType Calculation Works</h3>
<div class="diagram">
VT Response:
┌─────────────────────────────────────────────────────────────────┐
│ scans: {                                                        │
│   "Kaspersky": "Trojan-Ransom.Win32.Blocker.cfwh",             │
│   "McAfee": "RDN/Ransom!abc",                                   │
│   "Symantec": "Ransom.Cryptolocker",                            │
│   ...                                                           │
│ }                                                               │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│ Engines.classify(engine, detectionName)                         │
│   └── Wildcard Pattern Matching:                                │
│       "Trojan-Ransom.Win32.Blocker" contains "ransom" → ransom  │
│       "Trojan-Ransom.Win32.Blocker" contains "blocker" → ransom │
│       "Trojan-Ransom.Win32.Blocker" contains "troj" → trojan    │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│ Result: subTypes = ["ransom", "trojan"]                         │
└─────────────────────────────────────────────────────────────────┘
</div>

<h3>Code Location</h3>
<table>
    <tr>
        <th>File</th>
        <th>Purpose</th>
    </tr>
    <tr>
        <td><code>VirusTotalClassifier.java:209</code></td>
        <td><code>engines.classify(engine, result)</code> - entry point</td>
    </tr>
    <tr>
        <td><code>Engines.java</code></td>
        <td>Contains <code>wildcard</code> config: <code>Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt;</code></td>
    </tr>
    <tr>
        <td>MongoDB <code>ENGINES</code> collection</td>
        <td>Stores wildcard rules (<code>_id: "VirusTotal"</code>)</td>
    </tr>
</table>

<h3>Complete Wildcard Patterns</h3>

<h4>MALWARE SubTypes</h4>
<table>
    <tr>
        <th>SubType</th>
        <th>Wildcard Patterns (case-insensitive substring match)</th>
    </tr>
    <tr>
        <td><strong>ransom</strong></td>
        <td><code>ransom</code>, <code>blocker</code>, <code>caphaw</code></td>
    </tr>
    <tr>
        <td><strong>trojan</strong></td>
        <td><code>troj</code>, <code>backdoor</code>, <code>alman</code>, <code>alureon</code>, <code>autoit</code>, <code>bamital</code>, <code>beastdoor</code>, <code>berbew</code>, <code>bifrose</code>, <code>cidox</code>, <code>comame</code>, <code>cycbot</code>, <code>daum</code>, <code>delf</code>, <code>dorkbot</code>, <code>expiro</code>, <code>fakems</code>, <code>farfli</code>, <code>flyagent</code>, <code>fynloski</code>, <code>gobot</code>, <code>hesperbot</code>, <code>hllw</code>, <code>ipamor</code>, <code>ircbot</code>, <code>jadtre</code>, <code>jorik</code>, <code>kashu</code>, <code>kelihos</code>, <code>klone</code>, <code>koutodoor</code>, <code>krypt</code>, <code>lolyda</code>, <code>lop</code>, <code>mamianune</code>, <code>nebuler</code>, <code>nitol</code>, <code>nsanti</code>, <code>parite</code>, <code>pcclient</code>, <code>poisonivy</code>, <code>prorat</code>, <code>rebhip</code>, <code>redyms</code>, <code>refroso</code>, <code>resod</code>, <code>sality</code>, <code>servstart</code>, <code>siggen</code>, <code>sirefef</code>, <code>siscos</code>, <code>swisyn</code>, <code>swizzor</code>, <code>tanatos</code>, <code>tdss</code>, <code>turkojan</code>, <code>udr</code>, <code>vertex</code>, <code>viking</code>, <code>virtumonde</code>, <code>virut</code>, <code>vundo</code>, <code>wapomi</code>, <code>whiteice</code>, <code>xorer</code>, <code>xtrat</code>, <code>xtreme</code>, <code>yakes</code>, <code>zegost</code>, <code>zusy</code>, <code>zyx</code>, <code>oderoor</code>, <code>remtasu</code>, <code>bladabindi</code>, <code>hupigon</code>, <code>qhost</code>, <code>brontok</code>, <code>rbot</code>, <code>induc</code>, <code>horst</code>, <code>banload</code>, <code>kolab</code>, <code>poison</code>, <code>ripinip</code>, <code>vbkrypt</code>, <code>sddrop</code>, <code>carberp</code>, <code>dluca</code>, <code>luder</code>, <code>ciadoor</code>, <code>prosti</code>, <code>huhk</code>, <code>yaz</code>, <code>wabot</code>, <code>optix</code>, <code>lineage</code>, <code>scar</code>, <code>licia</code>, <code>bancos</code>, <code>polip</code>, <code>lmir</code>, <code>cinmus</code>, <code>cosmu</code>, <code>zlob</code>, <code>centim</code></td>
    </tr>
    <tr>
        <td><strong>spyware</strong></td>
        <td><code>spy</code>, <code>psw</code>, <code>pws</code>, <code>stealer</code>, <code>banker</code>, <code>gamania</code>, <code>hlux</code>, <code>qqpass</code>, <code>qqrob</code>, <code>simda</code>, <code>spynet</code>, <code>usteal</code>, <code>zbot</code>, <code>magania</code></td>
    </tr>
    <tr>
        <td><strong>virus</strong></td>
        <td><code>worm</code>, <code>virus</code>, <code>allaple</code>, <code>androm</code>, <code>bagle</code>, <code>beebone</code>, <code>benjamin</code>, <code>bugbear</code>, <code>cutwail</code>, <code>diple</code>, <code>fareit</code>, <code>fesber</code>, <code>fujack</code>, <code>gamarue</code>, <code>klez</code>, <code>krap</code>, <code>lightmoon</code>, <code>mabezat</code>, <code>mocmex</code>, <code>mydoom</code>, <code>neshta</code>, <code>pakes</code>, <code>palevo</code>, <code>pinfi</code>, <code>polipos</code>, <code>pykse</code>, <code>ramnit</code>, <code>rimecud</code>, <code>rontokbro</code>, <code>sdbot</code>, <code>sillyfdc</code>, <code>slenfbot</code>, <code>sobig</code>, <code>vbtroj</code>, <code>virtob</code>, <code>buzus</code></td>
    </tr>
    <tr>
        <td><strong>botnet</strong></td>
        <td><code>zeroaccess</code>, <code>zaccess</code>, <code>lethic</code>, <code>neurevt</code></td>
    </tr>
    <tr>
        <td><strong>breach</strong></td>
        <td><code>dropper</code>, <code>downloader</code>, <code>inject</code></td>
    </tr>
    <tr>
        <td><strong>general</strong></td>
        <td><code>rootkit</code>, <code>virtool</code>, <code>exploit</code>, <code>dialer</code>, <code>flooder</code>, <code>autorun</code>, <code>vb</code>, <code>ddos</code>, <code>variant</code></td>
    </tr>
</table>

<h4>UNWANTED SubTypes</h4>
<table>
    <tr>
        <th>SubType</th>
        <th>Wildcard Patterns</th>
    </tr>
    <tr>
        <td><strong>toolbar</strong></td>
        <td><code>toolbar</code>, <code>bandoo</code>, <code>conduit</code>, <code>defaulttab</code>, <code>sweetim</code></td>
    </tr>
    <tr>
        <td><strong>adware</strong></td>
        <td><code>adware</code>, <code>adpeak</code>, <code>amonetize</code>, <code>bettersurf</code>, <code>clearsearch</code>, <code>clickspring</code>, <code>ezula</code>, <code>henbang</code>, <code>navipromo</code>, <code>newnext</code>, <code>outbrowse</code>, <code>outobox</code>, <code>plushd</code>, <code>somoto</code>, <code>webdevaz</code>, <code>yontoo</code></td>
    </tr>
    <tr>
        <td><strong>general</strong></td>
        <td><code>pup</code>, <code>pua</code>, <code>application</code>, <code>miner</code>, <code>fake</code>, <code>fraud</code>, <code>joke</code>, <code>hoax</code>, <code>risk</code>, <code>install</code>, <code>clicker</code>, <code>riskware</code>, <code>bprotector</code>, <code>browsefox</code>, <code>bundlore</code>, <code>domaiq</code>, <code>ibryte</code>, <code>relevantknowledge</code>, <code>sprotector</code>, <code>startpage</code>, <code>wajam</code>, <code>softsonic</code>, <code>cnet</code></td>
    </tr>
</table>

<h4>HACKTOOL SubTypes</h4>
<table>
    <tr>
        <th>SubType</th>
        <th>Wildcard Patterns</th>
    </tr>
    <tr>
        <td><strong>remote</strong></td>
        <td><code>remoteadmin</code>, <code>ammyy</code></td>
    </tr>
    <tr>
        <td><strong>general</strong></td>
        <td><code>hacktool</code>, <code>winlock</code></td>
    </tr>
</table>

<h4>MALTOOL SubTypes</h4>
<table>
    <tr>
        <th>SubType</th>
        <th>Wildcard Patterns</th>
    </tr>
    <tr>
        <td><strong>loggers</strong></td>
        <td><code>keylog</code>, <code>logger</code>, <code>monitor</code>, <code>freekey</code>, <code>refog</code>, <code>kgbspy</code>, <code>powerkey</code>, <code>keyboardspy</code>, <code>personalinspector</code>, <code>perfkey</code>, <code>ardamax</code>, <code>spytector</code>, <code>spyboss</code></td>
    </tr>
    <tr>
        <td><strong>passwords</strong></td>
        <td><code>pswtool</code>, <code>mailpassview</code>, <code>pwdump</code></td>
    </tr>
</table>

<h4>SUSPICIOUS SubTypes</h4>
<table>
    <tr>
        <th>SubType</th>
        <th>Wildcard Patterns</th>
    </tr>
    <tr>
        <td><strong>heuristics</strong></td>
        <td><code>heur</code>, <code>behaveslike</code>, <code>lookslike</code></td>
    </tr>
    <tr>
        <td><strong>packed</strong></td>
        <td><code>pack</code>, <code>obfus</code>, <code>nakedpack</code></td>
    </tr>
    <tr>
        <td><strong>general</strong></td>
        <td><code>generic</code>, <code>suspicious</code></td>
    </tr>
</table>

<h3>Phoenix Migration Options for SubTypes</h3>

<div class="warning-box">
    <strong>Decision Required:</strong> How should Phoenix handle SubTypes?
</div>

<table>
    <tr>
        <th>Option</th>
        <th>Description</th>
        <th>Pros</th>
        <th>Cons</th>
    </tr>
    <tr>
        <td><strong>A. Pre-compute</strong></td>
        <td>Calculate SubType during ETL, store in TiDB</td>
        <td>Fast lookups, simple rules</td>
        <td>Need to update if patterns change</td>
    </tr>
    <tr>
        <td><strong>B. Store detection names</strong></td>
        <td>Store raw VT detection names, rules use regex</td>
        <td>Flexible, can update patterns in rules</td>
        <td>~70 detection names per file, storage heavy</td>
    </tr>
    <tr>
        <td><strong>C. Don't support</strong></td>
        <td>Only use Classification (malware/unwanted/etc.)</td>
        <td>Simple, already implemented</td>
        <td>Less granular detection</td>
    </tr>
</table>

<h3>Example: Rule-Based SubType Detection (Option B)</h3>
<p>If we enrich with VT detection names, Sigma rules can match patterns directly:</p>
<pre><code>detection:
    selection_ransomware:
        VT.DetectionNames|contains:
            - 'ransom'
            - 'blocker'
            - 'caphaw'
    condition: selection_ransomware
</code></pre>

</body>
</html>
